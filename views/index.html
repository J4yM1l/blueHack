<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Hello World</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">

    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        
        #map {
            position: absolute;
            top: 0%;
            bottom: 0%;
            width: 100%;
        }
    </style>
    <!-- left: 100%;
    
    bottom: 100%;
    right: 100%;
    height: 100%;
    margin: 100% 100% 100% 100%;
    padding: 100% 100% 100% 100%; -->
</head>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="antixss.js" type="text/javascript"></script>

<body>
        <div id='map'></div>
        <script>
            
            mapboxgl.accessToken = 'pk.eyJ1IjoiaG9kZ2VhIiwiYSI6ImNqOHlxYXJucTJkNG0zMnA4aXltdHloNGcifQ.TbFyOQ13Q075SwQu6XYVAQ';
            
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/light-v9',
                center: [0, 0],
                zoom: 15,
                minZoom: 10            
            });
            
            map.addControl(new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true,
                showUserLocation: true
            }));
            var lat = null, lng = null;
        
            function getLocation(){
                if(navigator.geolocation){
                    navigator.geolocation.getCurrentPosition(function(position) {
                        var locationMarker = null;
                        if (locationMarker){
                        // return if there is a locationMarker bug
                        return;
                        }

                        // sets default position to your position
                        lat = position.coords["latitude"];
                        lng = position.coords["longitude"];
                        console.log(lat + " " + lng);
                        },
                        function(error) {
                        console.log("Error: ", error);
                        },
                        {
                        enableHighAccuracy: true
                        }
                    );
                }
            }
        
            getLocation();
            map.setView([lat, lng], 17);
            
            map.on('load', function(e) {
                getRoute();
                map.flyTo({center: [lat, lng], zoom: 15, speed: 0.2});
            });
            
            function getRoute() {
                var start = [lat, lng];
                var end = [33,-84];
                var directionsRequest = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + start[0] + ',' + start[1] + ';' + end[0] + ',' + end[1] + '?geometries=geojson&access_token=' + mapboxgl.accessToken;
                $.ajax({
                    method: 'GET',
                    url: directionsRequest,
                }).done(function(data) {
                    var route = data.routes[0].geometry;
                    map.addLayer({
                        id: 'route',
                        type: 'line',
                        source: {
                            type: 'geojson',
                            data: {
                            type: 'Feature',
                            geometry: route 
                            }
                        },
                        paint: {
                            'line-width': 2
                        }
                    });
                    // Start Circle
                    map.addLayer({
                        id: 'start',
                        type: 'circle',
                        source: {
                            type: 'geojson',
                            data: {
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: str(start)
                            }
                            }
                        }
                    });
                    // End Circle
                    map.addLayer({
                        id: 'end',
                        type: 'circle',
                        source: {
                            type: 'geojson',
                            data: {
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: str(end)
                            }
                            }
                        }
                    });
                });
            }
        
        </script>

    </div>
</body>

</html>